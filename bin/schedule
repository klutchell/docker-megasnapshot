#!/usr/bin/env bash

if [ "$(id -u)" != "0" ]; then
	echo "This script must be run as root" 1>&2
	exit 1
fi

abs_root() { echo "$(cd "$(dirname "${1}")" && pwd)"; }
project_root="$(abs_root "$(abs_root "$0")")"

# install cron file while replacing the project root dir
sed "s|#PROJECT_ROOT#|$project_root|g" "$project_root/etc/cron.d/rsnapshot" > /etc/cron.d/rsnapshot

# set permissions
chmod 644 /etc/cron.d/rsnapshot
chown root:root /etc/cron.d/rsnapshot
